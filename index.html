<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Carved Spirits - Digital Gallery">
  <title>Carved Spirits - Digital Gallery</title>
  <style>
    /* Modern CSS Reset */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    body {
      min-height: 100vh;
      line-height: 1.5;
      text-rendering: optimizeSpeed;
    }

    img,
    picture,
    video,
    canvas,
    svg {
      display: block;
      max-width: 100%;
    }

    input,
    button,
    textarea,
    select {
      font: inherit;
    }

    p,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      overflow-wrap: break-word;
    }

    ul,
    ol {
      list-style: none;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    button {
      border: none;
      background: none;
      cursor: pointer;
    }

    /* CSS Custom Properties */
    :root {
      --color-bg: #0a0a0a;
      --color-text: #e8e8e8;
      --color-text-muted: #808080;
      --color-accent: #ffffff;
      --color-border: #1a1a1a;

      --font-primary: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica Neue", Arial, sans-serif;
      --font-mono: "SF Mono", Monaco, "Cascadia Code", "Roboto Mono", Consolas, monospace;

      --spacing-xs: 0.5rem;
      --spacing-sm: 1rem;
      --spacing-md: 2rem;
      --spacing-lg: 4rem;
      --spacing-xl: 6rem;
      --spacing-2xl: 8rem;

      --transition-smooth: 0.6s cubic-bezier(0.16, 1, 0.3, 1);
      --transition-fast: 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }

    /* Base Styles */
    html {
      scroll-behavior: auto;
      background-color: var(--color-bg);
    }

    body {
      font-family: var(--font-primary);
      color: var(--color-text);
      background-color: var(--color-bg);
      font-size: 16px;
      line-height: 1.6;
      overflow-x: hidden;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 var(--spacing-md);
    }

    /* Typography */
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      line-height: 1.2;
      font-weight: 400;
      letter-spacing: -0.02em;
    }

    /* Navigation */
    .nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      padding: var(--spacing-md) 0;
      mix-blend-mode: difference;
    }

    .nav-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 var(--spacing-md);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nav-logo {
      font-size: 1rem;
      font-weight: 400;
      color: var(--color-accent);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .nav-links {
      display: flex;
      gap: var(--spacing-lg);
    }

    .nav-link {
      font-size: 0.875rem;
      color: var(--color-accent);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    /* Hero Section */
    .hero {
      min-height: 150vh;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      padding: var(--spacing-2xl) var(--spacing-md);
      position: relative;
      overflow: visible;
      transform-origin: center center;
      will-change: transform;
    }

    .hero-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 150%;
      z-index: 1;
      pointer-events: none;
      transition: opacity 0.1s ease-out;
    }

    .hero-content {
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      transform: translateY(-50%);
      z-index: 2;
      pointer-events: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 var(--spacing-xl);
      width: 100%;
      max-width: 1600px;
      margin: 0 auto;
    }

    .hero-title {
      font-size: clamp(4rem, 15vw, 12rem);
      font-weight: 300;
      line-height: 0.85;
      display: flex;
      flex-direction: column;
      gap: 0;
      color: var(--color-accent);
      text-transform: uppercase;
      letter-spacing: -0.02em;
      opacity: 0;
      animation: fadeInUp 1s ease-out 0.3s forwards;
    }

    .hero-title-line {
      display: block;
      overflow: hidden;
    }

    .hero-title-line:first-child {
      text-align: left;
    }

    .hero-title-line:last-child {
      text-align: right;
    }

    .hero-subtitle {
      font-size: clamp(0.875rem, 2vw, 1.125rem);
      color: var(--color-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.2em;
      margin-top: var(--spacing-md);
      opacity: 0;
      animation: fadeInUp 1s ease-out 0.5s forwards;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .scroll-indicator {
      position: absolute;
      bottom: var(--spacing-lg);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--spacing-sm);
      font-size: 0.75rem;
      color: var(--color-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      z-index: 2;
      transition: opacity 0.1s ease-out;
      opacity: 0;
      animation: fadeInUp 1s ease-out 0.8s forwards;
    }

    .scroll-line {
      width: 1px;
      height: 60px;
      background: linear-gradient(to bottom, var(--color-text-muted), transparent);
      animation: scrollBounce 2s ease-in-out infinite;
    }

    @keyframes scrollBounce {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(10px);
      }
    }

    /* Projects Section */
    .projects {
      padding: var(--spacing-2xl) 0;
      min-height: 100vh;
      position: relative;
      z-index: 10;
      background-color: var(--color-bg);
    }

    .section-title {
      font-size: clamp(2rem, 6vw, 4rem);
      font-weight: 300;
      margin-bottom: var(--spacing-xl);
      text-align: center;
    }

    .projects-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(100%, 500px), 1fr));
      gap: var(--spacing-md);
      margin-top: var(--spacing-xl);
    }

    /* Project Card */
    .project-card {
      position: relative;
      aspect-ratio: 1;
      border: 1px solid var(--color-border);
      padding: var(--spacing-md);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background-color: rgba(255, 255, 255, 0.02);
      transition: border-color var(--transition-fast);
      cursor: pointer;
    }

    .project-card.description-expanded {
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
      scrollbar-color: var(--color-border) transparent;
    }

    /* Custom scrollbar for expanded project cards - Webkit browsers */
    .project-card.description-expanded::-webkit-scrollbar {
      width: 4px;
    }

    .project-card.description-expanded::-webkit-scrollbar-track {
      background: transparent;
    }

    .project-card.description-expanded::-webkit-scrollbar-thumb {
      background: var(--color-border);
      border-radius: 2px;
    }

    .project-card.description-expanded::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .project-card:hover {
      border-color: rgba(255, 255, 255, 0.2);
    }

    .project-card:hover .project-3d-container {
      opacity: 1;
    }

    .project-number {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      color: var(--color-text-muted);
      margin-bottom: auto;
    }

    .project-content {
      z-index: 2;
      pointer-events: none;
    }

    .project-title {
      font-size: clamp(1.5rem, 3vw, 2rem);
      font-weight: 300;
      margin-bottom: var(--spacing-xs);
    }

    .project-description {
      font-size: 0.875rem;
      color: var(--color-text-muted);
      margin-bottom: var(--spacing-md);
      line-height: 1.6;
      overflow: hidden;
      white-space: pre-line;
      transition: max-height 0.6s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s ease;
    }

    .project-description.truncated {
      max-height: 2.8em;
    }

    .description-wrapper {
      overflow: hidden;
      transition: max-height 0.6s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .description-wrapper.expanded {
      max-height: none !important;
    }

    .see-more-toggle {
      font-size: 0.875rem;
      color: var(--color-text-muted);
      cursor: pointer;
      transition: color var(--transition-fast);
      display: inline;
      font-weight: 400;
      text-decoration: underline;
      text-underline-offset: 2px;
      line-height: 1.6;
      pointer-events: auto;
    }

    .see-more-toggle:hover {
      color: var(--color-accent);
    }

    .project-tags {
      display: flex;
      gap: var(--spacing-xs);
      flex-wrap: wrap;
    }

    .tag {
      font-size: 0.75rem;
      font-family: var(--font-mono);
      color: var(--color-text-muted);
      border: 1px solid var(--color-border);
      padding: 0.25rem 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* 3D Container */
    .project-3d-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0.4;
      transition: opacity var(--transition-smooth);
      pointer-events: none;
    }

    .project-canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .project-expand {
      position: absolute;
      top: var(--spacing-md);
      right: var(--spacing-md);
      width: 40px;
      height: 40px;
      border: 1px solid var(--color-border);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
      z-index: 3;
    }

    .project-expand:hover {
      border-color: var(--color-accent);
      background-color: var(--color-accent);
    }

    .expand-icon {
      font-size: 1.5rem;
      color: var(--color-text);
      transition: color var(--transition-fast);
    }

    .project-expand:hover .expand-icon {
      color: var(--color-bg);
    }

    /* Project Modal */
    .project-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: var(--color-bg);
      z-index: 2000;
      display: flex;
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--transition-smooth);
    }

    .project-modal.active {
      opacity: 1;
      pointer-events: all;
    }

    .modal-canvas-container {
      flex: 1;
      position: relative;
    }

    .modal-canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* Gyroscope Toggle Button */
    .gyro-toggle {
      position: absolute;
      bottom: var(--spacing-md);
      right: var(--spacing-md);
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      z-index: 1000;
      cursor: pointer;
      transition: all var(--transition-fast);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .gyro-toggle:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.3);
      transform: scale(1.05);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
    }

    .gyro-toggle:active {
      transform: scale(0.95);
    }

    .gyro-icon-touch,
    .gyro-icon-gyro {
      display: flex;
      align-items: center;
      justify-content: center;
      transition: opacity var(--transition-fast);
    }

    /* Hide toggle on desktop */
    @media (min-width: 1025px) {
      .gyro-toggle {
        display: none !important;
      }
    }

    /* Mobile Hint Overlay */
    .mobile-hint {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: var(--spacing-md) var(--spacing-lg);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 999;
      pointer-events: none;
      animation: fadeInOut 3s ease-in-out forwards;
    }

    @keyframes fadeInOut {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.95);
      }

      10% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }

      80% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }

      100% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.95);
      }
    }

    .mobile-hint-text {
      color: var(--color-text);
      font-size: 1.1rem;
      font-weight: 500;
      margin: 0;
      text-align: center;
      white-space: nowrap;
    }

    /* Hide hint on desktop */
    @media (min-width: 1025px) {
      .mobile-hint {
        display: none !important;
      }
    }

    .modal-close {
      position: absolute;
      top: var(--spacing-md);
      right: var(--spacing-md);
      width: 50px;
      height: 50px;
      border: 1px solid var(--color-border);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2001;
      transition: all var(--transition-fast);
      mix-blend-mode: difference;
    }

    .modal-close:hover {
      border-color: var(--color-accent);
      background-color: var(--color-accent);
    }

    .close-icon {
      font-size: 2rem;
      color: var(--color-accent);
      line-height: 1;
      transition: color var(--transition-fast);
    }

    .modal-close:hover .close-icon {
      color: var(--color-bg);
    }

    .modal-info {
      width: 400px;
      height: 100vh;
      display: flex;
      flex-direction: column;
      border-left: 1px solid var(--color-border);
      overflow: hidden;
      position: relative;
    }

    .modal-header {
      flex-shrink: 0;
      position: sticky;
      top: 0;
      background-color: var(--color-bg);
      padding: var(--spacing-xl) var(--spacing-lg) var(--spacing-md) var(--spacing-lg);
      z-index: 10;
      border-bottom: 1px solid transparent;
      transition: border-color 0.3s ease;
    }

    .modal-info.scrolled .modal-header {
      border-bottom-color: var(--color-border);
    }

    .modal-description-wrapper {
      overflow-y: auto;
      overflow-x: hidden;
      flex: 1;
      min-height: 0;
      padding: 0 var(--spacing-lg) var(--spacing-xl) var(--spacing-lg);
      -webkit-overflow-scrolling: touch;
    }

    /* Custom scrollbar for modal description */
    .modal-description-wrapper::-webkit-scrollbar {
      width: 6px;
    }

    .modal-description-wrapper::-webkit-scrollbar-track {
      background: transparent;
    }

    .modal-description-wrapper::-webkit-scrollbar-thumb {
      background: var(--color-border);
      border-radius: 3px;
    }

    .modal-description-wrapper::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .modal-number {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      color: var(--color-text-muted);
      margin-bottom: var(--spacing-md);
    }

    .modal-title {
      font-size: 2.5rem;
      font-weight: 300;
      margin-bottom: var(--spacing-sm);
      line-height: 1.2;
    }

    .modal-description {
      font-size: 1rem;
      color: var(--color-text-muted);
      line-height: 1.8;
      white-space: pre-line;
    }

    .modal-tags {
      display: flex;
      gap: var(--spacing-xs);
      flex-wrap: wrap;
      margin-bottom: 0;
    }

    /* About Section */
    .about-section {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: var(--color-bg);
      z-index: 2000;
      display: flex;
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--transition-smooth);
    }

    .about-section.active {
      opacity: 1;
      pointer-events: all;
    }

    .about-container {
      width: 100%;
      height: 100%;
      position: relative;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .about-canvas {
      width: 100%;
      height: 100%;
      display: block;
      position: absolute;
      top: 0;
      left: 0;
    }

    .about-content {
      position: relative;
      z-index: 2;
      max-width: 800px;
      padding: var(--spacing-xl);
      text-align: center;
      margin: auto;
    }

    .about-text {
      font-size: clamp(1rem, 2vw, 1.25rem);
      line-height: 1.8;
      color: var(--color-text);
    }

    .about-text p {
      margin-bottom: var(--spacing-md);
    }

    .about-text p:last-child {
      margin-bottom: 0;
    }

    .about-close {
      position: absolute;
      top: var(--spacing-md);
      right: var(--spacing-md);
      width: 50px;
      height: 50px;
      border: 1px solid var(--color-border);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2001;
      transition: all var(--transition-fast);
      mix-blend-mode: difference;
      background-color: transparent;
      cursor: pointer;
    }

    .about-close:hover {
      border-color: var(--color-accent);
      background-color: var(--color-accent);
    }

    /* Footer */
    .footer {
      padding: var(--spacing-2xl) 0 var(--spacing-lg) 0;
      border-top: 1px solid var(--color-border);
    }

    .footer-content {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: var(--spacing-xl);
      margin-bottom: var(--spacing-xl);
    }

    .footer-title {
      font-size: clamp(2rem, 5vw, 3.5rem);
      font-weight: 300;
      margin-bottom: var(--spacing-md);
      line-height: 1.1;
    }

    .footer-email {
      font-size: clamp(1.5rem, 4vw, 2.5rem);
      font-weight: 300;
      color: var(--color-text-muted);
      transition: color var(--transition-fast);
      display: inline-block;
    }

    .footer-email:hover {
      color: var(--color-accent);
    }

    .footer-links {
      display: flex;
      gap: var(--spacing-xl);
    }

    .footer-column {
      min-width: 150px;
    }

    .footer-heading {
      font-size: 0.75rem;
      font-weight: 400;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--color-text-muted);
      margin-bottom: var(--spacing-md);
    }

    .footer-list {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .footer-link {
      font-size: 0.875rem;
      color: var(--color-text);
      transition: color var(--transition-fast);
    }

    .footer-link:hover {
      color: var(--color-text-muted);
    }

    .footer-bottom {
      padding-top: var(--spacing-lg);
      border-top: 1px solid var(--color-border);
      text-align: center;
    }

    .footer-copyright {
      font-size: 0.75rem;
      color: var(--color-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    /* Horizontal Scroll Section */
    .horizontal-scroll-section {
      min-height: 400vh;
      position: relative;
      background-color: var(--color-bg);
      z-index: 5;
    }

    .horizontal-scroll-container {
      position: sticky;
      top: 0;
      height: 100vh;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .horizontal-canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .horizontal-progress {
      position: absolute;
      bottom: var(--spacing-lg);
      left: 50%;
      transform: translateX(-50%);
      width: 300px;
      height: 2px;
      background-color: rgba(255, 255, 255, 0.1);
      z-index: 10;
    }

    .progress-bar {
      width: 0%;
      height: 100%;
      background-color: var(--color-accent);
      transition: width 0.1s ease-out;
    }

    /* Scroll Animations */
    [data-scroll-animate] {
      opacity: 0;
      transform: translateY(30px);
      transition: opacity var(--transition-smooth), transform var(--transition-smooth);
    }

    [data-scroll-animate].in-view {
      opacity: 1;
      transform: translateY(0);
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .hero-content {
        padding: 0 var(--spacing-md);
      }

      .hero-title {
        font-size: clamp(3rem, 12vw, 8rem);
      }

      .modal-info {
        width: 350px;
        padding: var(--spacing-lg) var(--spacing-md);
      }

      .footer-content {
        grid-template-columns: 1fr;
      }

      .footer-links {
        gap: var(--spacing-lg);
      }
    }

    @media (max-width: 768px) {
      :root {
        --spacing-lg: 3rem;
        --spacing-xl: 4rem;
        --spacing-2xl: 5rem;
      }

      .hero {
        min-height: 120vh;
      }

      .hero-canvas {
        height: 120%;
      }

      .hero-content {
        flex-direction: column;
        gap: var(--spacing-md);
        text-align: center;
      }

      .hero-title {
        font-size: clamp(2.5rem, 10vw, 6rem);
      }

      .hero-title-line:first-child,
      .hero-title-line:last-child {
        text-align: center;
      }

      .nav-links {
        gap: var(--spacing-md);
      }

      .projects-grid {
        grid-template-columns: 1fr;
      }

      .project-modal {
        flex-direction: column;
      }

      .modal-canvas-container {
        max-height: 50vh;
        min-height: 300px;
      }

      .modal-info {
        width: 100%;
        height: 50vh;
        max-height: 50vh;
        border-left: none;
        border-top: 1px solid var(--color-border);
      }

      .modal-header {
        padding: var(--spacing-md) var(--spacing-md) var(--spacing-sm) var(--spacing-md);
      }

      .modal-description-wrapper {
        padding: 0 var(--spacing-md) var(--spacing-md) var(--spacing-md);
      }

      .modal-title {
        font-size: 2rem;
      }

      .modal-description {
        font-size: 0.9375rem;
      }

      .footer-links {
        flex-direction: column;
        gap: var(--spacing-lg);
      }

      .about-content {
        padding: var(--spacing-md);
      }

      .about-text {
        font-size: 1rem;
      }
    }

    @media (max-width: 480px) {
      .nav-logo {
        font-size: 0.75rem;
      }

      .nav-links {
        gap: var(--spacing-sm);
      }

      .nav-link {
        font-size: 0.75rem;
      }

      .hero-title {
        font-size: clamp(2rem, 9vw, 4rem);
      }

      .project-card {
        padding: var(--spacing-sm);
      }

      .modal-header {
        padding: var(--spacing-sm) var(--spacing-sm) 0.5rem var(--spacing-sm);
      }

      .modal-description-wrapper {
        padding: 0 var(--spacing-sm) var(--spacing-sm) var(--spacing-sm);
      }

      .modal-title {
        font-size: 1.75rem;
      }

      .modal-description {
        font-size: 0.875rem;
      }
    }
  </style>
</head>

<body>
  <!-- Navigation -->
  <nav class="nav">
    <div class="nav-container">
      <a href="#" class="nav-logo">Carved Spirits</a>
      <ul class="nav-links">
        <li><a href="#projects" class="nav-link">Gallery</a></li>
        <li><a href="#about" class="nav-link" id="about-link">About</a></li>
      </ul>
    </div>
  </nav>

  <!-- Hero Section -->
  <header class="hero" id="hero">
    <canvas class="hero-canvas" id="hero-canvas"></canvas>
    <div class="hero-content">
      <h1 class="hero-title">
        <span class="hero-title-line">Carved</span>
        <span class="hero-title-line">Spirits</span>
      </h1>
    </div>
    <div class="scroll-indicator">
      <span>Scroll</span>
      <div class="scroll-line"></div>
    </div>
  </header>

  <!-- Horizontal Scroll Section -->
  <section class="horizontal-scroll-section" id="horizontal-scroll">
    <div class="horizontal-scroll-container">
      <canvas class="horizontal-canvas" id="horizontal-canvas"></canvas>
      <div class="horizontal-progress">
        <div class="progress-bar"></div>
      </div>
    </div>
  </section>

  <!-- Projects Section -->
  <section class="projects" id="projects">
    <div class="container">
      <h2 class="section-title" data-scroll-animate>Collection</h2>
      <div class="projects-grid">
        <!-- Project 1 -->
        <article class="project-card" data-project="1" data-scroll-animate>
          <div class="project-number">01</div>
          <div class="project-content">
            <h3 class="project-title">Bekom Mask</h3>
            <p class="project-description">This specific mask comes from the highlands of Western Cameroon, specifically from the Bekom chiefdom. People call this one a "cap mask" because of the way it’s worn, it sits horizontally on the head and doesn't even have eyeholes. It’s pretty unique. Its whole purpose is tied to various traditional ceremonies, especially the ones focused on fertility and honoring the original ancestors who started everything. It’s their way of staying connected to where they came from.</p>
            <div class="project-tags">
              <span class="tag">Cameroon</span>
              <span class="tag">Bamileke</span>
              <span class="tag">Bekom</span>
            </div>
          </div>
          <div class="project-3d-container" data-3d-target="1">
            <canvas class="project-canvas" id="canvas-1"></canvas>
          </div>
          <button class="project-expand" aria-label="Expand project">
            <span class="expand-icon">+</span>
          </button>
        </article>

        <!-- Project 2 -->
        <article class="project-card" data-project="2" data-scroll-animate>
          <div class="project-number">02</div>
          <div class="project-content">
            <h3 class="project-title">Mbangu Mask</h3>
            <p class="project-description">In the Kasaï region of the Democratic Republic of the Congo, the Pende people are famous for some pretty remarkable masks, but the Mbangu is easily one of the most unique. It represents the kind of suffering you get from sorcery or illness, and that twisted face—usually split between black and white—makes it stand out immediately. It’s a lot more than just something to look at, though; it’s a tool for spiritual and social work.

              For the Pende, the Mbangu is mostly about healing. During ceremonies, a dancer would wear it to act out the illness or pain. The mask basically acted like a container, drawing the sickness into itself so it could be kicked out of the person and the community. It was all about settling the pain and getting things back into balance.
              
              Even though it looks a bit unsettling, the Mbangu was also used for a bit of social commentary. Those exaggerated features were a way to poke fun at people's flaws or bad behavior in a humorous, indirect way. It kept everyone in check while making them think.
              
              The mask was also seen as a shield against bad vibes. By personifying deformity and sickness, the Mbangu would attract those negative forces just to neutralize them, protecting the village from spells or malevolent energy.
              
              The black and white colors are there to show how opposites exist together—good and evil, health and sickness, beauty and ugliness. It’s a reflection of how complicated life is and how you have to find an equilibrium. Finally, the Mbangu played a big part in initiation rites for young men. It represented the tough challenges life throws at you and, more importantly, the fact that you can actually overcome them.</p>
            <div class="project-tags">
              <span class="tag">Kasaï</span>
              <span class="tag">DR Congo</span>
              <span class="tag">Pende</span>
            </div>
          </div>
          <div class="project-3d-container" data-3d-target="2">
            <canvas class="project-canvas" id="canvas-2"></canvas>
          </div>
          <button class="project-expand" aria-label="Expand project">
            <span class="expand-icon">+</span>
          </button>
        </article>

        <!-- Project 3 -->
        <article class="project-card" data-project="3" data-scroll-animate>
          <div class="project-number">03</div>
          <div class="project-content">
            <h3 class="project-title">Songye Mask</h3>
            <p class="project-description">The kifwebe cult gets its name from the Songye word for "mask." It started around the turn of the last century, mainly to keep some social order. These masks vary a lot in shape and color depending on who they’re supposed to be, and they show up everywhere—from funerals and secret society initiations to healing rituals and warding off enemies.

              You can usually tell the difference between the spirits they represent. Male masks (kilume) have these high crests for wisdom and are covered in red, black, and white stripes. They’re meant to be the dominant ones who enforce the rules. Female masks (kikashi) are usually white, which connects them to the moon, and they’re often larger with no crest at all. They represent balance and kindness, and you can sometimes see surface scratches that look like scarification.
              
              Even though all the dancers are men, they use these different styles to play out different roles. In Luba traditions, the fertility dances happen during the new moon, often alongside mankishi figures. Most masks have holes along the edges for long fiber beards, but if those holes are missing, they’re called Kabemba, or "hawks." It’s a whole system of symbols just to tell a story or keep the peace.</p>
            <div class="project-tags">
              <span class="tag">DR Congo</span>
              <span class="tag">Songye</span>
              <span class="tag">Luba</span>
            </div>
          </div>
          <div class="project-3d-container" data-3d-target="3">
            <canvas class="project-canvas" id="canvas-3"></canvas>
          </div>
          <button class="project-expand" aria-label="Expand project">
            <span class="expand-icon">+</span>
          </button>
        </article>

        <!-- Project 4 -->
        <article class="project-card" data-project="4" data-scroll-animate>
          <div class="project-number">04</div>
          <div class="project-content">
            <h3 class="project-title">Ngbaka Mask</h3>
            <p class="project-description">This one, from the Ngbaka people of the Ubangi region, in the North of DR Congo. It’s almost certainly tied to an initiation rituals, mostly as a way of showing that someone actually finished the whole thing.</p>
            <div class="project-tags">
              <span class="tag">DR Congo</span>
              <span class="tag">Ngbaka</span>
            </div>
          </div>
          <div class="project-3d-container" data-3d-target="4">
            <canvas class="project-canvas" id="canvas-4"></canvas>
          </div>
          <button class="project-expand" aria-label="Expand project">
            <span class="expand-icon">+</span>
          </button>
        </article>

        <!-- Project 5 -->
        <article class="project-card" data-project="5" data-scroll-animate>
          <div class="project-number">05</div>
          <div class="project-content">
            <h3 class="project-title">Gouro Mask</h3>
            <p class="project-description">The Gouro people live over in West Africa, mostly in the center-west part of Côte d'Ivoire around places like Bouaflé and Sinfra. Their dances are basically split into two groups: the sacred ones—like Djè or Loh—and the ones they do just for the fun of it, for celebrations. You might see masks at these dances, or you might not; it depends on the occasion.

              Among the celebration dances, they have a bunch of different ones like the Djéla or the Flaly, but the big name everyone knows is the Zaouli. That name actually covers three things at once: the mask, the costume, and the whole traditional dance itself.
              
              Then you’ve got the Flaly, which is a mask with a woman’s face from the town of Gohitafla. It looks a lot like the Zaouli mask, but it’s got toucan feathers on it, which gives it its own look.
            <br><br>
            Yeah ok i didn't find what kind of mask it exactly is but i will soon enough ¯\_(ツ)_/¯
            </p>
            <div class="project-tags">
              <span class="tag">Gouro</span>
              <span class="tag">Ivory Coast</span>
            </div>
          </div>
          <div class="project-3d-container" data-3d-target="5">
            <canvas class="project-canvas" id="canvas-5"></canvas>
          </div>
          <button class="project-expand" aria-label="Expand project">
            <span class="expand-icon">+</span>
          </button>
        </article>

        <!-- Project 6 -->
        <article class="project-card" data-project="6" data-scroll-animate>
          <div class="project-number">06</div>
          <div class="project-content">
            <h3 class="project-title">Ogbodo enyi Mask</h3>
            <p class="project-description">In Southeast Nigeria, the Igbo people have created a huge, diverse variety of masks. Like most places in Africa, wearing them is strictly for the men. But there was this one time in 1975, in the village of Izzi, where an oracle actually suggested a woman should wear a mask like this several times a year to stop a tragic wave of infant deaths.

              This one is an elephant spirit. There’s a human head called an ntekpe popping out of the back, which marks it as either a "child of the spirit" or the spirit of a notable person. When these masks come out, it’s a sign that the ancestors are present—and they’re the ones responsible for the well-being of the living. Unlike most masks that move in packs, the ogbodo enyi performs solo, following a hierarchy based on age.
              
              It mixes human and elephant features and usually shows up during the dry season when the community has been purified and the paths are clear. It also makes an appearance at funerals for members of the specific age group it represents. Originally, the Ogbodo enyi character was pretty violent, roaming the village in a massive raffia robe and shouting threats. Nowadays, it’s much more benevolent, visiting the community to receive prayers and offerings. Some people also call these striking pieces "Wawa" masks.</p>
            <div class="project-tags">
              <span class="tag">Nigeria</span>
              <span class="tag">Igbo</span>
            </div>
          </div>
          <div class="project-3d-container" data-3d-target="6">
            <canvas class="project-canvas" id="canvas-6"></canvas>
          </div>
          <button class="project-expand" aria-label="Expand project">
            <span class="expand-icon">+</span>
          </button>
        </article>

        <!-- Project 7 -->
        <article class="project-card" data-project="7" data-scroll-animate>
          <div class="project-number">07</div>
          <div class="project-content">
            <h3 class="project-title">We Gere Mask</h3>
            <p class="project-description">Made of wood, horns, cowrie shells, hair, spent cartridges, and teeth.</p>
            <div class="project-tags">
              <span class="tag">Ivory Cost</span>
              <span class="tag">Liberia</span>
              <span class="tag">Dan</span>
            </div>
          </div>
          <div class="project-3d-container" data-3d-target="7">
            <canvas class="project-canvas" id="canvas-7"></canvas>
          </div>
          <button class="project-expand" aria-label="Expand project">
            <span class="expand-icon">+</span>
          </button>
        </article>

        <!-- Project 8 -->
        <article class="project-card" data-project="8" data-scroll-animate>
          <div class="project-number">08</div>
          <div class="project-content">
            <h3 class="project-title">Pende Gikhoko Pendant</h3>
            <p class="project-description">Back in the day, if you were a "somebody"—like the son of a chief or a big-shot notable—you’d get one of these after finishing the mukanda rites. It’s a whole initiation thing. Along with the pendant, you’d get a givule, which is supposed to be a piece of an ancestor’s soul.
              They carved them out of bone or ivory to show that these kids were finally men, inheriting all this spiritual and political weight.</p>
            <div class="project-tags">
              <span class="tag">DR Congo</span>
              <span class="tag">Pende</span>
            </div>
          </div>
          <div class="project-3d-container" data-3d-target="8">
            <canvas class="project-canvas" id="canvas-8"></canvas>
          </div>
          <button class="project-expand" aria-label="Expand project">
            <span class="expand-icon">+</span>
          </button>
        </article>

        <!-- Project 9 -->
        <article class="project-card" data-project="9" data-scroll-animate>
          <div class="project-number">09</div>
          <div class="project-content">
            <h3 class="project-title">Dan Mask</h3>
            <p class="project-description">Scared women's face</p>
            <div class="project-tags">
              <span class="tag">Ivory Cost</span>
              <span class="tag">Liberia</span>
              <span class="tag">Dan</span>
            </div>
          </div>
          <div class="project-3d-container" data-3d-target="9">
            <canvas class="project-canvas" id="canvas-9"></canvas>
          </div>
          <button class="project-expand" aria-label="Expand project">
            <span class="expand-icon">+</span>
          </button>
        </article>

        <!-- Project 10 -->
        <article class="project-card" data-project="10" data-scroll-animate>
          <div class="project-number">10</div>
          <div class="project-content">
            <h3 class="project-title">Nsembu Mask</h3>
            <p class="project-description">A culturally important ritual for the Kumu people is the circumcision of boys as they enter adulthood.  The nsembu mask is used exclusively by members of the Nkunda Secret Society for the purposes of adult initiation. They also use the mask for divination under the effects of hallucinogens.  The mask itself represents the diviner’s spirit.  Kumu masks are somewhat rare, but the known examples tend to have wide open eyes and mouths, frequently with sharp teeth.</p>
            <div class="project-tags">
              <span class="tag">DR Congo</span>
              <span class="tag">Kumu</span>
            </div>
          </div>
          <div class="project-3d-container" data-3d-target="10">
            <canvas class="project-canvas" id="canvas-10"></canvas>
          </div>
          <button class="project-expand" aria-label="Expand project">
            <span class="expand-icon">+</span>
          </button>
        </article>

        <!-- Project 11 -->
        <article class="project-card" data-project="11" data-scroll-animate>
          <div class="project-number">11</div>
          <div class="project-content">
            <h3 class="project-title">Salampasu Mask</h3>
            <p class="project-description">These masks really come out for the initiation rites. For the big event, they set up a wooden stage with panels that have these carvings of people on them. The faces on those panels use the exact same design as the masks, which is a pretty cool touch. You see that same look on a few rare painted statues too.
              Also, the Salampasu people are incredibly talented when it comes to metalwork. They’re basically master blacksmiths, and they really know how to handle a forge. It’s one of those things they’re just naturally great at.</p>
            <div class="project-tags">
              <span class="tag">DR Congo</span>
              <span class="tag">Salampasu</span>
            </div>
          </div>
          <div class="project-3d-container" data-3d-target="11">
            <canvas class="project-canvas" id="canvas-11"></canvas>
          </div>
          <button class="project-expand" aria-label="Expand project">
            <span class="expand-icon">+</span>
          </button>
        </article>

        <!-- Project 12 -->
        <article class="project-card" data-project="12" data-scroll-animate>
          <div class="project-number">12</div>
          <div class="project-content">
            <h3 class="project-title">Muminia Mask</h3>
            <p class="project-description">The Lega people originally came from Uganda further to the Northeast, and they were likely the first ones to settle in the Umaniema region of the Congo. Their whole political and religious world is run by the Bwami association. It’s pretty specific to them, even though you see similar groups with different names in other nearby tribes.

              This particular mask is a muminia type. Each community only ever had one of them, which is a big deal. For any initiation to any grade to actually happen, the muminia had to be there. It’s the mask they use for the very first Bwami initiation, and it represents a bit of a contradiction—it stands for a high-ranking, powerful member of the association, but also a troublemaker. It’s got a bit of both in it.</p>
            <div class="project-tags">
              <span class="tag">DR Congo</span>
              <span class="tag">Lega</span>
              <span class="tag">Bwami</span>
            </div>
          </div>
          <div class="project-3d-container" data-3d-target="12">
            <canvas class="project-canvas" id="canvas-12"></canvas>
          </div>
          <button class="project-expand" aria-label="Expand project">
            <span class="expand-icon">+</span>
          </button>
        </article>
      </div>
    </div>
  </section>

  <!-- About Section -->
  <section class="about-section" id="about">
    <button class="about-close" aria-label="Close about">
      <span class="close-icon">&times;</span>
    </button>
    <div class="about-container">
      <canvas class="about-canvas" id="about-canvas"></canvas>
      <div class="about-content">
        <div class="about-text">
          <p>I’m Raph. These are some African masks from various ethnic groups that I’ve grown to be quite fond of, for one reason or another. I wanted to show them to you mostly because they’ve been on my mind. Growing up, our house was full of them, and if I’m being honest, I thought they were terrifying. I really did. Lately, though, I’ve felt this need to get a little closer to my roots. This whole project is just a small tribute to that feeling.</p>

          <p>I should probably give an actual reason for doing this, other than the lazy but very true one, which is that I think it looks good. The thing is, the older I get, the more everything starts to separate into these sharp little piles in my head. Stuff that used to mildly bug me now really gets under my skin. Stuff I once sort of liked does the same thing, which feels unfair, but there it is.</p>

          <p>What really sticks with me, though, is how much simply never showed up. Pre-colonial Africa, for instance, might as well have been a rumor. It wasn’t in the books that were easy to find. It wasn’t on TV. And I can’t pretend I was some heroic kid actively searching for it either. I didn’t know to look. So when I finally did, it felt less like learning something new and more like realizing something had been quietly missing the whole time. Luckily, some people went digging before I ever thought to, and left a trail behind. Otherwise I’m not sure I would have known where to start.</p>

          <p>This is probably the part where I’m supposed to explain why this page exists at all. It started on one of those rainy days that make everything look a little more dramatic than it deserves to be. I was at home when I noticed this trippy-looking mask sitting out on the balcony, doing a very convincing impression of something that was about to rot quietly and be forgotten. So I rushed out and rescued it, because letting a wooden thing die slowly in the rain felt wrong in a way I can’t fully justify.</p>

          <p>Later, being a 3D enthusiast and all, I opened Blender and immediately faced the important question of what to name the file. It was either african_mask or save_wooden_beauty_from_balcony, which tells you roughly where my head was at. After that, I did what anyone with too much time and an internet connection does. I spent a few hours browsing through various self-proclaimed art galleries and some deeply questionable merchant websites. And the one thing they all seemed to have in common was that they were selling these things. Re-selling them, really. That part stuck with me, and it irritated me more than I expected.</p>

          <p>What feels off about it isn’t simply that they’re being sold. Lots of things are sold, and that part alone isn’t the problem. It’s the way it happens. Ownership changes hands without any ceremony at all, like that part never mattered. Profit shows up dressed as appreciation, which makes it harder to call out. And somewhere in the process, the context just slips away.</p>

          <p>It feels worse when you realize that many of these pieces aren’t decorative objects to begin with. They belong to someone’s religion, someone’s way of making sense of the world. But online they’re flattened into product descriptions, advertised as a way to bring a little “exoticism” into your living room, as if that was ever the point.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Expanded Project Modal -->
  <div class="project-modal" id="project-modal">
    <button class="modal-close" aria-label="Close modal">
      <span class="close-icon">&times;</span>
    </button>
    <div class="modal-canvas-container">
      <canvas class="modal-canvas" id="modal-canvas"></canvas>
      <div class="mobile-hint" id="mobile-hint" style="display: none;">
        <p class="mobile-hint-text">Swipe to rotate</p>
      </div>
    </div>
    <div class="modal-info">
      <div class="modal-header">
        <div class="modal-number"></div>
        <h2 class="modal-title"></h2>
        <div class="modal-tags"></div>
      </div>
      <div class="modal-description-wrapper">
        <p class="modal-description"></p>
      </div>
    </div>
  </div>

  <!-- Load Three.js and dependencies from CDN -->
  <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
        "@studio-freight/lenis": "https://cdn.jsdelivr.net/npm/@studio-freight/lenis@1.0.42/dist/lenis.mjs"
      }
    }
  </script>

  <script type="module">
    // Import dependencies
    import * as THREE from 'three';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
    import Lenis from '@studio-freight/lenis';
    import { SceneManager, ModalSceneManager } from './js/three-scene.js';

    // Detect base URL for GitHub Pages or local development
    const BASE_URL = window.location.pathname.includes('/carved_spirits/')
      ? '/carved_spirits/'
      : '/';

    const MODEL_BASE_PATHS = [
      BASE_URL + 'models/',
      BASE_URL + 'public/models/'
    ];

    // ===== PLY Model Loader =====
    const PLY_MODELS_CONFIG = [
      {
        filename: 'bawl.glb',
        title: 'Geometric Dreams',
        subtitle: 'Abstract 3D composition exploring form and space',
        tags: ['3D Design', 'Abstract'],
        scale: 1.0,
        position: { x: 0, y: 0, z: 0 },
        rotation: { x: 0, y: 0, z: 0 },
        projectId: '1'
      },
      {
        filename: 'half.glb',
        title: 'Fluid Motion',
        subtitle: 'Dynamic interaction study with organic shapes',
        tags: ['Interactive', 'Animation'],
        scale: 1.0,
        position: { x: 0, y: 0, z: 0 },
        rotation: { x: 0, y: 0, z: 0 },
        projectId: '2'
      },
      {
        filename: 'jarjar.glb',
        title: 'Minimal Essence',
        subtitle: 'Reductionist approach to 3D visualization',
        tags: ['Minimalism', 'Visual'],
        scale: 1.0,
        position: { x: 0, y: 0, z: 0 },
        rotation: { x: 0, y: 0, z: 0 },
        projectId: '3'
      },
      {
        filename: 'long.glb',
        title: 'Digital Sculpture',
        subtitle: 'Contemporary digital art meets traditional form',
        tags: ['Sculpture', 'Digital Art'],
        scale: 1.0,
        position: { x: 0, y: 0, z: 0 },
        rotation: { x: 0, y: 0, z: 0 },
        projectId: '4'
      },
      {
        filename: 'oreille.glb',
        title: 'Organic Form',
        subtitle: 'Exploring natural curves and biomorphic design',
        tags: ['Organic', 'Sculpture', 'Form'],
        scale: 1.0,
        position: { x: 0, y: 0, z: 0 },
        rotation: { x: 0, y: 0, z: 0 },
        projectId: '5'
      },
      {
        filename: 'box.glb',
        title: 'Cubic Structure',
        subtitle: 'Exploring geometric fundamentals and spatial relationships',
        tags: ['Geometry', 'Minimal', 'Architecture'],
        scale: 1.0,
        position: { x: 0, y: 0, z: 0 },
        rotation: { x: 0, y: 0, z: 0 },
        projectId: '6'
      },
      {
        filename: 'dragon.glb',
        title: 'Mythical Form',
        subtitle: 'Organic complexity and detailed surface modeling',
        tags: ['Character', 'Organic', 'Fantasy'],
        scale: 1.0,
        position: { x: 0, y: 0, z: 0 },
        rotation: { x: 0, y: 0, z: 0 },
        projectId: '7'
      },
      {
        filename: 'orange.glb',
        title: 'Citrus Study',
        subtitle: 'Photorealistic texturing and natural form capture',
        tags: ['Photorealism', 'Nature', 'Texture'],
        scale: 1.0,
        position: { x: 0, y: 0, z: 0 },
        rotation: { x: 0, y: 0, z: 0 },
        projectId: '8'
      },
      {
        filename: 'scar.glb',
        title: 'Surface Detail',
        subtitle: 'Intricate surface modeling and material exploration',
        tags: ['Detail', 'Material', 'Texture'],
        scale: 1.0,
        position: { x: 0, y: 0, z: 0 },
        rotation: { x: 0, y: 0, z: 0 },
        projectId: '9'
      },
      {
        filename: 'squarecolors.glb',
        title: 'Chromatic Grid',
        subtitle: 'Color theory application in geometric composition',
        tags: ['Color', 'Grid', 'Abstract'],
        scale: 1.0,
        position: { x: 0, y: 0, z: 0 },
        rotation: { x: 0, y: 0, z: 0 },
        projectId: '10'
      },
      {
        filename: 'squaregrey.glb',
        title: 'Monochrome Composition',
        subtitle: 'Study in grayscale and form without color distraction',
        tags: ['Monochrome', 'Minimal', 'Study'],
        scale: 1.0,
        position: { x: 0, y: 0, z: 0 },
        rotation: { x: 0, y: 0, z: 0 },
        projectId: '11'
      },
      {
        filename: 'whiteface.glb',
        title: 'Portrait Study',
        subtitle: 'Character modeling and facial feature exploration',
        tags: ['Portrait', 'Character', 'Study'],
        scale: 1.0,
        position: { x: 0, y: 0, z: 0 },
        rotation: { x: 0, y: 0, z: 0 },
        projectId: '12'
      }
    ];

    class PLYModelLoader {
      constructor() {
        this.loader = new GLTFLoader();
        this.basePaths = MODEL_BASE_PATHS;
      }

      loadModel(config, baseIndex = 0) {
        return new Promise((resolve, reject) => {
          const basePath = this.basePaths[baseIndex] || this.basePaths[0];
          const path = basePath + config.filename;

          console.log(`Loading GLB model: ${config.filename}`);

          this.loader.load(
            path,
            (gltf) => {
              const object = gltf.scene;

              const box = new THREE.Box3().setFromObject(object);
              const center = new THREE.Vector3();
              box.getCenter(center);
              object.position.sub(center);

              object.traverse((child) => {
                if (child.isMesh) {
                  child.castShadow = true;
                  child.receiveShadow = true;
                }
              });

              object.scale.set(config.scale, config.scale, config.scale);
              object.position.set(
                config.position.x,
                config.position.y,
                config.position.z
              );
              object.rotation.set(
                config.rotation.x,
                config.rotation.y,
                config.rotation.z
              );

              object.userData.plyConfig = config;
              object.userData.isPLYModel = true;
              object.userData.title = config.title || config.filename;
              object.userData.subtitle = config.subtitle || '';
              object.userData.tags = config.tags || [];

              console.log(`Successfully loaded GLB model: ${config.filename}`);
              resolve(object);
            },
            (progress) => {
              const percentComplete = (progress.loaded / progress.total) * 100;
              if (!isNaN(percentComplete)) {
                console.log(`Loading ${config.filename}: ${percentComplete.toFixed(1)}%`);
              }
            },
            (error) => {
              const nextIndex = baseIndex + 1;
              if (nextIndex < this.basePaths.length) {
                console.warn(`Retrying ${config.filename} with fallback base path...`);
                this.loadModel(config, nextIndex).then(resolve).catch(reject);
                return;
              }

              console.error(`Error loading GLB model ${config.filename}:`, error);
              reject(error);
            }
          );
        });
      }
    }

    // ===== Text Hover Animation =====
    class TextHoverAnimation {
      static defaults = {
        duration: 600,
        stagger: 35,
        easing: 'cubic-bezier(0.65, 0, 0.35, 1)',
        direction: 'up',
        preserveSpaces: true,
        noReplacement: false,
        disableHover: false,
        classNames: {
          wrapper: 'th-letters-wrapper',
          container: 'th-letter-container',
          letter: 'th-letter',
          original: 'th-letter-original',
          clone: 'th-letter-clone',
          hovered: 'th-hovered'
        },
        onHoverStart: null,
        onHoverEnd: null,
        onLetterHoverStart: null,
        onLetterHoverEnd: null
      };

      constructor(selector, options = {}) {
        this.options = { ...TextHoverAnimation.defaults, ...options };
        this.elements = this._getElements(selector);
        this.animationId = `th-animation-${Math.random().toString(36).substr(2, 9)}`;

        if (this.elements.length === 0) {
          console.warn('TextHoverAnimation: No elements found for selector:', selector);
          return;
        }

        this._injectStyles();
        this._init();
      }

      _getElements(selector) {
        if (typeof selector === 'string') {
          return Array.from(document.querySelectorAll(selector));
        } else if (selector instanceof NodeList) {
          return Array.from(selector);
        } else if (Array.isArray(selector)) {
          return selector;
        } else if (selector instanceof HTMLElement) {
          return [selector];
        }
        return [];
      }

      _injectStyles() {
        const styleId = `th-animation-styles-${this.animationId}`;

        if (document.getElementById(styleId)) return;

        const { duration, easing, direction, classNames, noReplacement } = this.options;
        const transforms = this._getTransforms(direction);

        const css = `
          .${classNames.wrapper} {
            display: inline-flex;
          }
          
          .${classNames.container} {
            display: inline-block;
            position: relative;
            overflow: hidden;
            height: 1em;
            line-height: 1em;
            vertical-align: baseline;
          }
          
          .${classNames.letter} {
            display: block;
            transition: transform ${duration}ms ${easing};
            will-change: transform;
            backface-visibility: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
          }
          
          .${classNames.original} {
            transform: ${transforms.originalDefault};
          }
          
          .${classNames.clone} {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            transform: ${transforms.cloneDefault};
            ${noReplacement ? 'opacity: 0;' : ''}
          }
          
          .${classNames.container}.${classNames.hovered} .${classNames.original} {
            transform: ${transforms.originalHovered};
          }
          
          .${classNames.container}.${classNames.hovered} .${classNames.clone} {
            transform: ${noReplacement ? transforms.cloneDefault : transforms.cloneHovered};
            ${noReplacement ? 'opacity: 0;' : ''}
          }
        `;

        const styleEl = document.createElement('style');
        styleEl.id = styleId;
        styleEl.textContent = css;
        document.head.appendChild(styleEl);
      }

      _getTransforms(direction) {
        const transforms = {
          up: {
            originalDefault: 'translateY(0)',
            cloneDefault: 'translateY(100%)',
            originalHovered: 'translateY(-100%)',
            cloneHovered: 'translateY(0)'
          },
          down: {
            originalDefault: 'translateY(0)',
            cloneDefault: 'translateY(-100%)',
            originalHovered: 'translateY(100%)',
            cloneHovered: 'translateY(0)'
          },
          left: {
            originalDefault: 'translateX(0)',
            cloneDefault: 'translateX(100%)',
            originalHovered: 'translateX(-100%)',
            cloneHovered: 'translateX(0)'
          },
          right: {
            originalDefault: 'translateX(0)',
            cloneDefault: 'translateX(-100%)',
            originalHovered: 'translateX(100%)',
            cloneHovered: 'translateX(0)'
          }
        };

        return transforms[direction] || transforms.up;
      }

      _init() {
        this.elements.forEach(element => {
          this._splitText(element);
          this._addEventListeners(element);
        });
      }

      _splitText(element) {
        const text = element.textContent;
        const { classNames, preserveSpaces } = this.options;

        element.setAttribute('data-th-original-text', text);
        element.innerHTML = '';
        element.style.position = 'relative';
        element.style.display = 'inline-block';

        const wrapper = document.createElement('span');
        wrapper.className = classNames.wrapper;

        text.split('').forEach((char, index) => {
          const letterContainer = document.createElement('span');
          letterContainer.className = classNames.container;
          letterContainer.setAttribute('data-th-index', index);

          const displayChar = (char === ' ' && preserveSpaces) ? '\u00A0' : char;

          const letterOriginal = document.createElement('span');
          letterOriginal.className = `${classNames.letter} ${classNames.original}`;
          letterOriginal.textContent = displayChar;
          letterOriginal.setAttribute('aria-hidden', 'true');

          const letterClone = document.createElement('span');
          letterClone.className = `${classNames.letter} ${classNames.clone}`;
          letterClone.textContent = displayChar;
          letterClone.setAttribute('aria-hidden', 'true');

          letterContainer.appendChild(letterOriginal);
          letterContainer.appendChild(letterClone);
          wrapper.appendChild(letterContainer);
        });

        element.appendChild(wrapper);
      }

      _addEventListeners(element) {
        if (!this.options.disableHover) {
          element.addEventListener('mouseenter', () => this._animateIn(element));
          element.addEventListener('mouseleave', () => this._animateOut(element));
        }
      }

      _animateIn(element) {
        const { classNames, stagger, onHoverStart, onLetterHoverStart } = this.options;
        const letterContainers = element.querySelectorAll(`.${classNames.container}`);

        if (typeof onHoverStart === 'function') {
          onHoverStart(element);
        }

        letterContainers.forEach((container, index) => {
          const timeoutId = setTimeout(() => {
            container.classList.add(classNames.hovered);

            if (typeof onLetterHoverStart === 'function') {
              onLetterHoverStart(container, index);
            }
          }, index * stagger);

          container.setAttribute('data-th-timeout', timeoutId);
        });
      }

      _animateOut(element) {
        const { classNames, stagger, onHoverEnd, onLetterHoverEnd } = this.options;
        const letterContainers = element.querySelectorAll(`.${classNames.container}`);

        letterContainers.forEach((container, index) => {
          const timeoutId = container.getAttribute('data-th-timeout');
          if (timeoutId) {
            clearTimeout(parseInt(timeoutId));
          }

          const reverseTimeoutId = setTimeout(() => {
            container.classList.remove(classNames.hovered);

            if (typeof onLetterHoverEnd === 'function') {
              onLetterHoverEnd(container, index);
            }
          }, index * stagger);

          container.setAttribute('data-th-timeout', reverseTimeoutId);
        });

        if (typeof onHoverEnd === 'function') {
          onHoverEnd(element);
        }
      }

      // Public methods to manually trigger animation
      hide(element) {
        if (!element && this.elements.length > 0) {
          this.elements.forEach(el => this._animateIn(el));
        } else if (element) {
          this._animateIn(element);
        }
      }

      show(element) {
        if (!element && this.elements.length > 0) {
          this.elements.forEach(el => this._animateOut(el));
        } else if (element) {
          this._animateOut(element);
        }
      }
    }

    // ===== Lenis Smooth Scrolling =====
    function initLenis() {
      const lenis = new Lenis({
        duration: 1.2,
        easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
        orientation: 'vertical',
        gestureOrientation: 'vertical',
        smoothWheel: true,
        wheelMultiplier: 1,
        smoothTouch: false,
        touchMultiplier: 2,
        infinite: false,
      });

      function raf(time) {
        lenis.raf(time);
        requestAnimationFrame(raf);
      }

      requestAnimationFrame(raf);

      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            lenis.scrollTo(target, {
              offset: -100,
              duration: 1.5,
            });
          }
        });
      });

      return lenis;
    }

    function initHeroScrollAnimation(lenis, heroTextScene) {
      const hero = document.getElementById('hero');
      const heroCanvas = document.getElementById('hero-canvas');
      const heroContent = document.querySelector('.hero-content');
      const scrollIndicator = document.querySelector('.scroll-indicator');
      const projectsSection = document.getElementById('projects');

      if (!hero || !projectsSection) return;

      lenis.on('scroll', ({ scroll }) => {
        const heroHeight = hero.offsetHeight;
        const scrollProgress = Math.min(1, Math.max(0, scroll / (heroHeight * 0.8)));

        if (heroTextScene) {
          heroTextScene.setScrollProgress(scrollProgress);
        }

        const opacity = 1 - scrollProgress;
        const fadeOpacity = Math.max(0, 1 - scrollProgress * 1.5);

        if (heroCanvas) {
          heroCanvas.style.opacity = fadeOpacity;
        }

        if (heroContent) {
          heroContent.style.opacity = fadeOpacity;
        }

        if (scrollIndicator) {
          scrollIndicator.style.opacity = Math.max(0, 1 - scrollProgress * 3);
        }

        const scale = 1 + scrollProgress * 0.1;
        if (hero) {
          hero.style.transform = `scale(${scale})`;
        }
      });
    }

    function initScrollAnimations() {
      const observerOptions = {
        threshold: 0.15,
        rootMargin: '0px 0px -100px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('in-view');
          }
        });
      }, observerOptions);

      const animateElements = document.querySelectorAll('[data-scroll-animate]');
      animateElements.forEach(el => observer.observe(el));

      return observer;
    }

    function initHorizontalScrollAnimation(lenis, horizontalScene) {
      const horizontalSection = document.getElementById('horizontal-scroll');
      const progressBar = document.querySelector('.progress-bar');

      if (!horizontalSection || !horizontalScene) return;

      lenis.on('scroll', ({ scroll }) => {
        const sectionTop = horizontalSection.offsetTop;
        const sectionHeight = horizontalSection.offsetHeight;
        const viewportHeight = window.innerHeight;

        const sectionStart = sectionTop;
        const sectionEnd = sectionTop + sectionHeight - viewportHeight;

        if (scroll >= sectionStart && scroll <= sectionEnd) {
          const scrollInSection = scroll - sectionStart;
          const scrollableHeight = sectionHeight - viewportHeight;
          const progress = Math.min(1, Math.max(0, scrollInSection / scrollableHeight));

          horizontalScene.setScrollProgress(progress);

          if (progressBar) {
            progressBar.style.width = `${progress * 100}%`;
          }
        } else if (scroll < sectionStart) {
          horizontalScene.setScrollProgress(0);
          if (progressBar) {
            progressBar.style.width = '0%';
          }
        } else {
          horizontalScene.setScrollProgress(1);
          if (progressBar) {
            progressBar.style.width = '100%';
          }
        }
      });
    }

    // ===== Hero Text Scene =====
    class HeroTextScene {
      constructor(canvas) {
        this.canvas = canvas;
        this.scene = null;
        this.camera = null;
        this.renderer = null;
        this.treeModel = null;
        this.animationId = null;
        this.mouse = new THREE.Vector2();
        this.targetRotation = { x: 0, y: 0 };
        this.currentRotation = { x: 0, y: 0 };
        this.scrollProgress = 0;
        this.isLoaded = false;

        this.init();
      }

      init() {
        this.scene = new THREE.Scene();

        const aspect = window.innerWidth / (window.innerHeight * 1.5);
        this.camera = new THREE.PerspectiveCamera(50, aspect, 0.1, 1000);
        this.camera.position.set(0, 0, 15);

        this.renderer = new THREE.WebGLRenderer({
          canvas: this.canvas,
          alpha: true,
          antialias: true,
        });
        this.renderer.setSize(window.innerWidth, window.innerHeight * 1.5);
        this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        this.renderer.setClearColor(0x000000, 0);

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        this.scene.add(ambientLight);

        const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight1.position.set(5, 10, 5);
        this.scene.add(directionalLight1);

        const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.4);
        directionalLight2.position.set(-5, -10, 5);
        this.scene.add(directionalLight2);

        const pointLight = new THREE.PointLight(0xffffff, 0.5);
        pointLight.position.set(0, 0, 10);
        this.scene.add(pointLight);

        this.loadTreeModel();

        window.addEventListener('mousemove', this.onMouseMove.bind(this));
        window.addEventListener('resize', this.handleResize.bind(this));

        this.animate();
      }

      loadTreeModel(baseIndex = 0) {
        const loader = new GLTFLoader();
        const basePath = MODEL_BASE_PATHS[baseIndex] || MODEL_BASE_PATHS[0];

        loader.load(
          basePath + 'tree.glb',
          (gltf) => {
            this.treeModel = gltf.scene;

            const box = new THREE.Box3().setFromObject(this.treeModel);
            const center = box.getCenter(new THREE.Vector3());
            const size = box.getSize(new THREE.Vector3());

            this.treeModel.position.x = -center.x;
            this.treeModel.position.y = -center.y;
            this.treeModel.position.z = -center.z;

            const maxDim = Math.max(size.x, size.y, size.z);
            const scale = 20 / maxDim;
            this.treeModel.scale.set(scale, scale, scale);

            this.treeModel.traverse((child) => {
              if (child.isMesh) {
                child.castShadow = true;
                child.receiveShadow = true;

                if (child.material) {
                  child.material.needsUpdate = true;
                }
              }
            });

            this.scene.add(this.treeModel);
            this.isLoaded = true;
            console.log('Tree model loaded successfully');
          },
          (progress) => {
            console.log('Loading tree model:', (progress.loaded / progress.total * 100) + '%');
          },
          (error) => {
            const nextIndex = baseIndex + 1;
            if (nextIndex < MODEL_BASE_PATHS.length) {
              console.warn('Retrying tree model with fallback base path...');
              this.loadTreeModel(nextIndex);
              return;
            }

            console.error('Error loading tree model:', error);
          }
        );
      }

      onMouseMove(event) {
        this.mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        this.mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
      }

      setScrollProgress(progress) {
        this.scrollProgress = Math.min(1, Math.max(0, progress));
      }

      animate() {
        this.animationId = requestAnimationFrame(this.animate.bind(this));

        if (this.treeModel) {
          this.targetRotation.y = this.mouse.x * 0.1;
          this.targetRotation.x = this.mouse.y * 0.05;

          this.currentRotation.x += (this.targetRotation.x - this.currentRotation.x) * 0.05;
          this.currentRotation.y += (this.targetRotation.y - this.currentRotation.y) * 0.05;

          this.treeModel.rotation.y = this.currentRotation.y;
          this.treeModel.rotation.x = this.currentRotation.x;

          this.treeModel.rotation.y += 0.001;
        }

        this.renderer.render(this.scene, this.camera);
      }

      handleResize() {
        const width = window.innerWidth;
        const height = window.innerHeight * 1.5;

        this.camera.aspect = width / height;
        this.camera.updateProjectionMatrix();

        this.renderer.setSize(width, height);
        this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      }

      dispose() {
        if (this.animationId) {
          cancelAnimationFrame(this.animationId);
        }

        if (this.treeModel) {
          this.treeModel.traverse((child) => {
            if (child.geometry) child.geometry.dispose();
            if (child.material) {
              if (Array.isArray(child.material)) {
                child.material.forEach(mat => mat.dispose());
              } else {
                child.material.dispose();
              }
            }
          });
          this.scene.remove(this.treeModel);
        }

        if (this.renderer) {
          this.renderer.dispose();
        }

        window.removeEventListener('mousemove', this.onMouseMove);
        window.removeEventListener('resize', this.handleResize);
      }
    }

    // ===== Horizontal Scroll Scene =====
    class HorizontalScrollScene {
      constructor(container) {
        this.container = container;
        this.canvas = container.querySelector('.horizontal-canvas');
        this.scene = null;
        this.camera = null;
        this.renderer = null;
        this.shapes = [];
        this.animationId = null;
        this.currentShapeIndex = 0;
        this.scrollProgress = 0;

        this.init();
      }

      init() {
        this.scene = new THREE.Scene();

        const aspect = this.canvas.clientWidth / this.canvas.clientHeight;
        this.camera = new THREE.PerspectiveCamera(45, aspect, 0.1, 100);
        this.camera.position.z = 5;

        this.renderer = new THREE.WebGLRenderer({
          canvas: this.canvas,
          alpha: true,
          antialias: true,
        });
        this.renderer.setSize(this.canvas.clientWidth, this.canvas.clientHeight);
        this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        this.renderer.setClearColor(0x000000, 0);

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        this.scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 5, 5);
        this.scene.add(directionalLight);

        const backLight = new THREE.DirectionalLight(0xffffff, 0.4);
        backLight.position.set(-5, -5, -5);
        this.scene.add(backLight);

        this.loadPLYModels();

        this.animate();
      }

      async loadPLYModels() {
        if (PLY_MODELS_CONFIG.length === 0) {
          console.warn('No GLB models configured to load');
          return;
        }

        try {
          const loader = new PLYModelLoader();

          const modelsWithProjects = PLY_MODELS_CONFIG.filter(config => config.projectId);
          const modelsWithoutProjects = PLY_MODELS_CONFIG.filter(config => !config.projectId);

          modelsWithProjects.sort((a, b) => parseInt(a.projectId) - parseInt(b.projectId));

          const allModelsInOrder = [...modelsWithProjects, ...modelsWithoutProjects];

          for (const config of allModelsInOrder) {
            const model = await loader.loadModel(config);

            model.position.set(10, 0, 0);
            model.scale.set(0, 0, 0);
            model.userData.targetPosition = { x: 0, y: 0, z: 0 };
            model.userData.index = this.shapes.length;
            model.userData.visible = false;
            model.userData.isGLBModel = true;

            this.shapes.push(model);
            this.scene.add(model);

            console.log(`Added horizontal scroll model ${this.shapes.length}: ${model.userData.title}`);
          }

          console.log(`Configured ${this.shapes.length} GLB model(s) in horizontal scroll`);
        } catch (error) {
          console.error('Error loading GLB models in HorizontalScrollScene:', error);
        }
      }

      updateShapes(progress) {
        const numShapes = this.shapes.length;
        const progressPerShape = 1 / numShapes;

        this.shapes.forEach((shape, index) => {
          const shapeStartProgress = index * progressPerShape;
          const shapeEndProgress = (index + 1) * progressPerShape;

          let shapeProgress = (progress - shapeStartProgress) / progressPerShape;
          shapeProgress = Math.max(0, Math.min(1, shapeProgress));

          const easeOutQuart = (t) => 1 - Math.pow(1 - t, 4);
          const easedProgress = easeOutQuart(shapeProgress);

          const startX = 10;
          const targetPos = shape.userData.targetPosition;
          const endX = typeof targetPos === 'object' ? targetPos.x : targetPos.x || 0;
          shape.position.x = startX + (endX - startX) * easedProgress;

          const scale = easedProgress;
          shape.scale.set(scale, scale, scale);

          if (shapeProgress > 0.01) {
            shape.userData.visible = true;
          }

          if (progress > shapeEndProgress) {
            const exitProgress = (progress - shapeEndProgress) / (progressPerShape * 0.5);
            const exitEased = Math.min(1, exitProgress);

            shape.position.x = endX - exitEased * 15;

            const opacity = 1 - exitEased;
            shape.traverse((child) => {
              if (child.material) {
                if (Array.isArray(child.material)) {
                  child.material.forEach(mat => {
                    mat.opacity = opacity;
                    mat.transparent = true;
                  });
                } else {
                  child.material.opacity = opacity;
                  child.material.transparent = true;
                }
              }
            });

            const exitScale = 1 - exitEased * 0.5;
            shape.scale.set(exitScale, exitScale, exitScale);
          } else {
            shape.traverse((child) => {
              if (child.material) {
                if (Array.isArray(child.material)) {
                  child.material.forEach(mat => {
                    mat.opacity = easedProgress;
                    mat.transparent = easedProgress < 1;
                  });
                } else {
                  child.material.opacity = easedProgress;
                  child.material.transparent = easedProgress < 1;
                }
              }
            });
          }
        });
      }

      animate() {
        this.animationId = requestAnimationFrame(this.animate.bind(this));

        this.renderer.render(this.scene, this.camera);
      }

      setScrollProgress(progress) {
        this.scrollProgress = progress;
        this.updateShapes(progress);
      }

      handleResize() {
        const width = this.canvas.clientWidth;
        const height = this.canvas.clientHeight;

        this.camera.aspect = width / height;
        this.camera.updateProjectionMatrix();

        this.renderer.setSize(width, height);
        this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      }

      dispose() {
        if (this.animationId) {
          cancelAnimationFrame(this.animationId);
        }

        this.shapes.forEach(shape => {
          shape.traverse((child) => {
            if (child.geometry) child.geometry.dispose();
            if (child.material) {
              if (Array.isArray(child.material)) {
                child.material.forEach(mat => mat.dispose());
              } else {
                child.material.dispose();
              }
            }
          });
          this.scene.remove(shape);
        });
        this.shapes = [];

        if (this.renderer) {
          this.renderer.dispose();
        }
      }
    }

    // ===== Project Manager =====
    class ProjectManager {
      constructor() {
        this.scenes = new Map();
        this.modalScene = null;
        this.currentProject = null;
        this.modal = document.getElementById('project-modal');
        this.modalCanvas = document.getElementById('modal-canvas');
        this.modalClose = document.querySelector('.modal-close');

        this.init();
      }

      init() {
        const projectCards = document.querySelectorAll('.project-card');
        projectCards.forEach(card => {
          const projectId = card.dataset.project;
          const canvas = card.querySelector('.project-canvas');

          if (canvas) {
            const scene = new SceneManager(canvas, projectId);
            this.scenes.set(projectId, scene);
          }

          const expandBtn = card.querySelector('.project-expand');
          if (expandBtn) {
            expandBtn.addEventListener('click', (e) => {
              e.stopPropagation();
              this.openModal(projectId, card);
            });
          }

          card.addEventListener('click', () => {
            this.openModal(projectId, card);
          });
        });

        if (this.modalClose) {
          this.modalClose.addEventListener('click', () => {
            this.closeModal();
          });
        }

        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && this.modal.classList.contains('active')) {
            this.closeModal();
          }
        });

        window.addEventListener('resize', () => {
          this.handleResize();
        });
      }

      openModal(projectId, card) {
        this.currentProject = projectId;

        const title = card.querySelector('.project-title').textContent;
        const descriptionEl = card.querySelector('.project-description');
        // Get the full text if it exists, otherwise use the regular text
        const description = descriptionEl.getAttribute('data-full-text') || descriptionEl.textContent;
        const number = card.querySelector('.project-number').textContent;
        const tags = Array.from(card.querySelectorAll('.tag')).map(tag => tag.textContent);

        document.querySelector('.modal-number').textContent = number;
        document.querySelector('.modal-title').textContent = title;
        document.querySelector('.modal-description').textContent = description;

        const modalTagsContainer = document.querySelector('.modal-tags');
        modalTagsContainer.innerHTML = tags.map(tag =>
          `<span class="tag">${tag}</span>`
        ).join('');

        if (this.modalScene) {
          this.modalScene.dispose();
        }
        this.modalScene = new ModalSceneManager(this.modalCanvas, projectId);

        this.modal.classList.add('active');
        document.body.style.overflow = 'hidden';

        // Show mobile hint on first visit (mobile only)
        this.showMobileHint();

        // Add scroll listener for sticky header border effect
        const modalInfo = document.querySelector('.modal-info');
        const descriptionWrapper = document.querySelector('.modal-description-wrapper');

        if (descriptionWrapper) {
          const handleScroll = () => {
            if (descriptionWrapper.scrollTop > 0) {
              modalInfo.classList.add('scrolled');
            } else {
              modalInfo.classList.remove('scrolled');
            }
          };

          descriptionWrapper.addEventListener('scroll', handleScroll);
          this.modalScrollHandler = handleScroll;
        }

        setTimeout(() => {
          if (this.modalScene) {
            this.modalScene.handleResize();
          }
        }, 100);
      }

      showMobileHint() {
        // Only show on mobile devices
        const isMobile = ('ontouchstart' in window || navigator.maxTouchPoints > 0)
          && window.innerWidth <= 1024;

        if (!isMobile) return;

        // Check if user has seen the hint before
        const hasSeenHint = localStorage.getItem('carved_spirits_mobile_hint_seen');

        if (!hasSeenHint) {
          const hintEl = document.getElementById('mobile-hint');
          if (hintEl) {
            hintEl.style.display = 'block';

            // Mark as seen after showing
            setTimeout(() => {
              localStorage.setItem('carved_spirits_mobile_hint_seen', 'true');
              hintEl.style.display = 'none';
            }, 3000);
          }
        }
      }

      closeModal() {
        this.modal.classList.remove('active');
        document.body.style.overflow = '';

        // Remove scroll listener
        const descriptionWrapper = document.querySelector('.modal-description-wrapper');
        if (descriptionWrapper && this.modalScrollHandler) {
          descriptionWrapper.removeEventListener('scroll', this.modalScrollHandler);
          this.modalScrollHandler = null;
        }

        // Remove scrolled class
        const modalInfo = document.querySelector('.modal-info');
        if (modalInfo) {
          modalInfo.classList.remove('scrolled');
        }

        if (this.modalScene) {
          this.modalScene.dispose();
          this.modalScene = null;
        }

        this.currentProject = null;
      }

      handleResize() {
        this.scenes.forEach(scene => {
          scene.handleResize();
        });

        if (this.modalScene) {
          this.modalScene.handleResize();
        }
      }
    }

    // ===== Initialize Description Truncation =====
    function initDescriptionTruncation() {
      const MAX_CHARS = 50;

      document.querySelectorAll('.project-card').forEach(card => {
        const descriptionEl = card.querySelector('.project-description');
        if (!descriptionEl) return;

        const fullText = descriptionEl.textContent.trim();

        // Only add see more/less if text exceeds max characters
        if (fullText.length > MAX_CHARS) {
          const truncatedText = fullText.substring(0, MAX_CHARS);

          // Store the full text as a data attribute
          descriptionEl.setAttribute('data-full-text', fullText);
          descriptionEl.setAttribute('data-truncated-text', truncatedText);

          // Create wrapper for smooth height animation
          const wrapper = document.createElement('div');
          wrapper.className = 'description-wrapper';

          // Create content holder
          const content = document.createElement('span');
          content.textContent = truncatedText + '... ';

          // Create see more toggle as inline element
          const toggleBtn = document.createElement('span');
          toggleBtn.className = 'see-more-toggle';
          toggleBtn.textContent = 'see more';

          // Replace description content
          descriptionEl.innerHTML = '';
          wrapper.appendChild(content);
          wrapper.appendChild(toggleBtn);
          descriptionEl.appendChild(wrapper);

          // Measure heights
          let truncatedHeight = wrapper.scrollHeight;
          content.textContent = fullText + ' ';
          let fullHeight = wrapper.scrollHeight;
          content.textContent = truncatedText + '... ';

          // Set initial height
          wrapper.style.maxHeight = truncatedHeight + 'px';

          let isExpanded = false;

          // Add click handler
          toggleBtn.addEventListener('click', (e) => {
            e.stopPropagation(); // Prevent card click

            if (isExpanded) {
              // Collapse
              card.classList.remove('description-expanded');
              wrapper.classList.remove('expanded');
              wrapper.style.maxHeight = fullHeight + 'px';
              requestAnimationFrame(() => {
                wrapper.style.maxHeight = truncatedHeight + 'px';
              });

              setTimeout(() => {
                content.textContent = truncatedText + '... ';
                toggleBtn.textContent = 'see more';

                // Remeasure truncated height
                const newTruncatedHeight = wrapper.scrollHeight;
                wrapper.style.maxHeight = newTruncatedHeight + 'px';
              }, 600);

              isExpanded = false;
            } else {
              // Expand
              const currentHeight = wrapper.scrollHeight;
              content.textContent = fullText + ' ';
              const newFullHeight = wrapper.scrollHeight;
              content.textContent = truncatedText + '... ';

              wrapper.style.maxHeight = currentHeight + 'px';
              requestAnimationFrame(() => {
                content.textContent = fullText + ' ';
                toggleBtn.textContent = 'see less';
                // Let the wrapper expand fully, card will handle scrolling
                wrapper.style.maxHeight = newFullHeight + 'px';
                wrapper.classList.add('expanded');
                card.classList.add('description-expanded');
              });

              fullHeight = newFullHeight;
              isExpanded = true;
            }
          });
        }
      });
    }

    // ===== Initialize About Section =====
    function initAboutSection(heroTextScene) {
      const aboutSection = document.getElementById('about');
      const aboutLink = document.getElementById('about-link');
      const aboutClose = document.querySelector('.about-close');
      const aboutCanvas = document.getElementById('about-canvas');
      let aboutTreeScene = null;

      function openAbout() {
        aboutSection.classList.add('active');
        document.body.style.overflow = 'hidden';

        if (!aboutTreeScene && aboutCanvas) {
          aboutTreeScene = new HeroTextScene(aboutCanvas);

          aboutTreeScene.handleResize = function () {
            const width = window.innerWidth;
            const height = window.innerHeight;

            this.camera.aspect = width / height;
            this.camera.updateProjectionMatrix();

            this.renderer.setSize(width, height);
            this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
          };

          setTimeout(() => {
            if (aboutTreeScene) {
              const width = window.innerWidth;
              const height = window.innerHeight;

              aboutTreeScene.camera.aspect = width / height;
              aboutTreeScene.camera.updateProjectionMatrix();

              aboutTreeScene.camera.position.set(0, 0, 20);

              aboutTreeScene.renderer.setSize(width, height);
              aboutTreeScene.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            }
          }, 100);
        }
      }

      function closeAbout() {
        aboutSection.classList.remove('active');
        document.body.style.overflow = '';

        if (aboutTreeScene) {
          aboutTreeScene.dispose();
          aboutTreeScene = null;
        }
      }

      if (aboutLink) {
        aboutLink.addEventListener('click', (e) => {
          e.preventDefault();
          openAbout();
        });
      }

      if (aboutClose) {
        aboutClose.addEventListener('click', () => {
          closeAbout();
        });
      }

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && aboutSection.classList.contains('active')) {
          closeAbout();
        }
      });

      if (aboutSection) {
        aboutSection.addEventListener('click', (e) => {
          if (e.target === aboutSection) {
            closeAbout();
          }
        });
      }
    }

    // ===== Initialize Scroll Reactive Header =====
    function initScrollReactiveHeader() {
      const SCROLL_THRESHOLD = 20;
      let lastScrollY = window.scrollY || window.pageYOffset;
      let isHidden = false;
      let ticking = false;

      // Get all nav elements to animate
      const navLogo = document.querySelector('.nav-logo');
      const navLinks = document.querySelectorAll('.nav-link');
      const allNavElements = [navLogo, ...navLinks].filter(el => el);

      // Initialize animations with noReplacement and disableHover for scroll behavior
      const animations = allNavElements.map(element => {
        return new TextHoverAnimation(element, {
          duration: 600,
          stagger: 35,
          easing: 'cubic-bezier(0.65, 0, 0.35, 1)',
          direction: 'up',
          noReplacement: true,
          disableHover: true
        });
      });

      // Handle scroll direction
      const handleScroll = () => {
        const currentScrollY = window.scrollY || window.pageYOffset;

        // Don't do anything if we're at the very top
        if (currentScrollY < SCROLL_THRESHOLD) {
          if (isHidden) {
            animations.forEach(animation => animation.show());
            isHidden = false;
          }
          lastScrollY = currentScrollY;
          ticking = false;
          return;
        }

        // Determine scroll direction
        const scrollingDown = currentScrollY > lastScrollY;
        const scrollingUp = currentScrollY < lastScrollY;

        // Hide when scrolling down
        if (scrollingDown && !isHidden) {
          animations.forEach(animation => animation.hide());
          isHidden = true;
        }
        // Show when scrolling up
        else if (scrollingUp && isHidden) {
          animations.forEach(animation => animation.show());
          isHidden = false;
        }

        lastScrollY = currentScrollY;
        ticking = false;
      };

      // Use requestAnimationFrame for better performance
      window.addEventListener('scroll', () => {
        if (!ticking) {
          window.requestAnimationFrame(handleScroll);
          ticking = true;
        }
      });

      return animations;
    }

    // ===== Main Init =====
    function init() {
      // Initialize scroll-reactive header (includes logo and nav links)
      initScrollReactiveHeader();

      const lenis = initLenis();

      initScrollAnimations();

      const heroCanvas = document.getElementById('hero-canvas');
      let heroTextScene = null;

      if (heroCanvas) {
        heroTextScene = new HeroTextScene(heroCanvas);
      }

      initHeroScrollAnimation(lenis, heroTextScene);

      const horizontalScrollContainer = document.querySelector('.horizontal-scroll-container');
      let horizontalScene = null;

      if (horizontalScrollContainer) {
        horizontalScene = new HorizontalScrollScene(horizontalScrollContainer);
        initHorizontalScrollAnimation(lenis, horizontalScene);

        window.addEventListener('resize', () => {
          if (horizontalScene) {
            horizontalScene.handleResize();
          }
        });
      }

      const projectManager = new ProjectManager();

      initDescriptionTruncation();

      initAboutSection(heroTextScene);

      window.addEventListener('load', () => {
        document.body.classList.add('loaded');
      });

      console.log('Portfolio initialized');
    }

    // Start the app
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>

</html>